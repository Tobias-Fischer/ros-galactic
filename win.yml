pool:
  vmImage: windows-2019
trigger:
- buildbranch_win
pr: none
stages:
- stage: stage_0
  jobs:
  - job: stage_0_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-ament-lint-common ros-galactic-foonathan-memory-vendor
          ros-galactic-orocos-kdl
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-ament-lint-common ros-galactic-foonathan-memory-vendor
        ros-galactic-orocos-kdl
- stage: stage_1
  jobs:
  - job: stage_1_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-python-cmake-module ros-galactic-performance-test-fixture
          ros-galactic-mimick-vendor ros-galactic-ament-cmake-ros ros-galactic-rosidl-adapter
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-python-cmake-module ros-galactic-performance-test-fixture
        ros-galactic-mimick-vendor ros-galactic-ament-cmake-ros ros-galactic-rosidl-adapter
  - job: stage_1_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosidl-typesupport-interface ros-galactic-fastrtps-cmake-module
          ros-galactic-fastrtps ros-galactic-rti-connext-dds-cmake-module ros-galactic-rmw-implementation-cmake
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosidl-typesupport-interface ros-galactic-fastrtps-cmake-module
        ros-galactic-fastrtps ros-galactic-rti-connext-dds-cmake-module ros-galactic-rmw-implementation-cmake
  - job: stage_1_job_2
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-spdlog-vendor ros-galactic-ament-index-cpp
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-spdlog-vendor ros-galactic-ament-index-cpp
- stage: stage_2
  jobs:
  - job: stage_2_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-launch-testing-ament-cmake ros-galactic-rosidl-parser
          ros-galactic-rosidl-runtime-cpp ros-galactic-tracetools ros-galactic-console-bridge-vendor
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-launch-testing-ament-cmake ros-galactic-rosidl-parser
        ros-galactic-rosidl-runtime-cpp ros-galactic-tracetools ros-galactic-console-bridge-vendor
  - job: stage_2_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-urdf-parser-plugin
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-urdf-parser-plugin
- stage: stage_3
  jobs:
  - job: stage_3_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rcutils ros-galactic-rosidl-cmake ros-galactic-urdfdom
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rcutils ros-galactic-rosidl-cmake ros-galactic-urdfdom
- stage: stage_4
  jobs:
  - job: stage_4_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosidl-runtime-c ros-galactic-rcpputils
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosidl-runtime-c ros-galactic-rcpputils
- stage: stage_5
  jobs:
  - job: stage_5_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rmw ros-galactic-rosidl-typesupport-introspection-c
          ros-galactic-rosidl-generator-c ros-galactic-libyaml-vendor ros-galactic-rcl-logging-interface
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rmw ros-galactic-rosidl-typesupport-introspection-c
        ros-galactic-rosidl-generator-c ros-galactic-libyaml-vendor ros-galactic-rcl-logging-interface
  - job: stage_5_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-class-loader
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-class-loader
- stage: stage_6
  jobs:
  - job: stage_6_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosidl-typesupport-fastrtps-cpp ros-galactic-rosidl-typesupport-introspection-cpp
          ros-galactic-rosidl-generator-cpp ros-galactic-rcl-yaml-param-parser ros-galactic-rcl-logging-spdlog
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosidl-typesupport-fastrtps-cpp ros-galactic-rosidl-typesupport-introspection-cpp
        ros-galactic-rosidl-generator-cpp ros-galactic-rcl-yaml-param-parser ros-galactic-rcl-logging-spdlog
  - job: stage_6_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-pluginlib
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-pluginlib
- stage: stage_7
  jobs:
  - job: stage_7_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosidl-typesupport-fastrtps-c ros-galactic-urdf
          ros-galactic-rosidl-typesupport-c ros-galactic-kdl-parser
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosidl-typesupport-fastrtps-c ros-galactic-urdf
        ros-galactic-rosidl-typesupport-c ros-galactic-kdl-parser
- stage: stage_8
  jobs:
  - job: stage_8_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosidl-typesupport-cpp ros-galactic-rosidl-generator-py
          ros-galactic-rosidl-default-runtime ros-galactic-rosidl-default-generators
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosidl-typesupport-cpp ros-galactic-rosidl-generator-py
        ros-galactic-rosidl-default-runtime ros-galactic-rosidl-default-generators
- stage: stage_9
  jobs:
  - job: stage_9_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-unique-identifier-msgs ros-galactic-builtin-interfaces
          ros-galactic-rmw-dds-common ros-galactic-lifecycle-msgs ros-galactic-std-srvs
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-unique-identifier-msgs ros-galactic-builtin-interfaces
        ros-galactic-rmw-dds-common ros-galactic-lifecycle-msgs ros-galactic-std-srvs
- stage: stage_10
  jobs:
  - job: stage_10_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-action-msgs ros-galactic-rmw-fastrtps-shared-cpp
          ros-galactic-rmw-connextdds-common ros-galactic-rcl-interfaces ros-galactic-std-msgs
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-action-msgs ros-galactic-rmw-fastrtps-shared-cpp
        ros-galactic-rmw-connextdds-common ros-galactic-rcl-interfaces ros-galactic-std-msgs
  - job: stage_10_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-statistics-msgs ros-galactic-rosgraph-msgs ros-galactic-rosbag2-interfaces
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-statistics-msgs ros-galactic-rosgraph-msgs ros-galactic-rosbag2-interfaces
- stage: stage_11
  jobs:
  - job: stage_11_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-test-msgs ros-galactic-rmw-connextdds ros-galactic-geometry-msgs
          ros-galactic-composition-interfaces ros-galactic-actionlib-msgs
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-test-msgs ros-galactic-rmw-connextdds ros-galactic-geometry-msgs
        ros-galactic-composition-interfaces ros-galactic-actionlib-msgs
  - job: stage_11_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-ros2cli-test-interfaces
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-ros2cli-test-interfaces
- stage: stage_12
  jobs:
  - job: stage_12_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rmw-fastrtps-dynamic-cpp ros-galactic-rmw-fastrtps-cpp
          ros-galactic-tf2 ros-galactic-sensor-msgs ros-galactic-tf2-msgs
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rmw-fastrtps-dynamic-cpp ros-galactic-rmw-fastrtps-cpp
        ros-galactic-tf2 ros-galactic-sensor-msgs ros-galactic-tf2-msgs
  - job: stage_12_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-nav-msgs ros-galactic-shape-msgs ros-galactic-trajectory-msgs
          ros-galactic-visualization-msgs ros-galactic-diagnostic-msgs
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-nav-msgs ros-galactic-shape-msgs ros-galactic-trajectory-msgs
        ros-galactic-visualization-msgs ros-galactic-diagnostic-msgs
  - job: stage_12_job_2
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosidl-runtime-py
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosidl-runtime-py
- stage: stage_13
  jobs:
  - job: stage_13_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rmw-implementation ros-galactic-stereo-msgs
          ros-galactic-tf2-eigen-kdl
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rmw-implementation ros-galactic-stereo-msgs
        ros-galactic-tf2-eigen-kdl
- stage: stage_14
  jobs:
  - job: stage_14_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rcl ros-galactic-common-interfaces
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rcl ros-galactic-common-interfaces
- stage: stage_15
  jobs:
  - job: stage_15_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rcl-action ros-galactic-libstatistics-collector
          ros-galactic-rcl-lifecycle
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rcl-action ros-galactic-libstatistics-collector
        ros-galactic-rcl-lifecycle
- stage: stage_16
  jobs:
  - job: stage_16_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rclpy ros-galactic-rclcpp
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rclpy ros-galactic-rclcpp
- stage: stage_17
  jobs:
  - job: stage_17_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-launch-ros ros-galactic-tf2-py ros-galactic-rclcpp-components
          ros-galactic-rclcpp-action ros-galactic-message-filters
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-launch-ros ros-galactic-tf2-py ros-galactic-rclcpp-components
        ros-galactic-rclcpp-action ros-galactic-message-filters
  - job: stage_17_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rclcpp-lifecycle ros-galactic-rosbag2-test-common
          ros-galactic-ros2cli
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rclcpp-lifecycle ros-galactic-rosbag2-test-common
        ros-galactic-ros2cli
- stage: stage_18
  jobs:
  - job: stage_18_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-launch-testing-ros ros-galactic-tf2-ros-py ros-galactic-tf2-ros
          ros-galactic-rosbag2-storage ros-galactic-ros2lifecycle-test-fixtures
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-launch-testing-ros ros-galactic-tf2-ros-py ros-galactic-tf2-ros
        ros-galactic-rosbag2-storage ros-galactic-ros2lifecycle-test-fixtures
  - job: stage_18_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-ros2multicast
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-ros2multicast
- stage: stage_19
  jobs:
  - job: stage_19_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-tf2-geometry-msgs ros-galactic-robot-state-publisher
          ros-galactic-tf2-kdl ros-galactic-tf2-eigen ros-galactic-rosbag2-storage-default-plugins
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-tf2-geometry-msgs ros-galactic-robot-state-publisher
        ros-galactic-tf2-kdl ros-galactic-tf2-eigen ros-galactic-rosbag2-storage-default-plugins
  - job: stage_19_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-tf2-sensor-msgs ros-galactic-ros2test ros-galactic-tf2-tools
          ros-galactic-tf2-bullet
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-tf2-sensor-msgs ros-galactic-ros2test ros-galactic-tf2-tools
        ros-galactic-tf2-bullet
- stage: stage_20
  jobs:
  - job: stage_20_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosbag2-cpp ros-galactic-ros-testing ros-galactic-geometry2
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosbag2-cpp ros-galactic-ros-testing ros-galactic-geometry2
- stage: stage_21
  jobs:
  - job: stage_21_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosbag2-compression ros-galactic-ros2pkg ros-galactic-ros2service
          ros-galactic-ros2node ros-galactic-sros2
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosbag2-compression ros-galactic-ros2pkg ros-galactic-ros2service
        ros-galactic-ros2node ros-galactic-sros2
  - job: stage_21_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-ros2topic ros-galactic-ros2interface ros-galactic-ros2doctor
          ros-galactic-ros2action
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-ros2topic ros-galactic-ros2interface ros-galactic-ros2doctor
        ros-galactic-ros2action
- stage: stage_22
  jobs:
  - job: stage_22_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosbag2-transport ros-galactic-ros2run ros-galactic-ros2param
          ros-galactic-rosbag2-compression-zstd ros-galactic-ros2lifecycle
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosbag2-transport ros-galactic-ros2run ros-galactic-ros2param
        ros-galactic-rosbag2-compression-zstd ros-galactic-ros2lifecycle
  - job: stage_22_job_1
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-ros2launch ros-galactic-sros2-cmake
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-ros2launch ros-galactic-sros2-cmake
- stage: stage_23
  jobs:
  - job: stage_23_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosbag2-py ros-galactic-ros2component ros-galactic-ros2bag
          ros-galactic-ros2cli-common-extensions
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosbag2-py ros-galactic-ros2component ros-galactic-ros2bag
        ros-galactic-ros2cli-common-extensions
- stage: stage_24
  jobs:
  - job: stage_24_job_0
    variables:
      CONDA_BLD_PATH: C:\\bld\\
    steps:
    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH
    - script: conda install -c conda-forge --yes --quiet conda-build pip mamba ruamel.yaml
        anaconda-client
      displayName: Install conda-build, boa and activate environment
    - script: |
        set "CI=azure"
        call %CONDA%\\condabin\\conda_hook.bat
        call %CONDA%\\condabin\\conda.bat activate base

        :: 2 cores available on Appveyor workers: https://www.appveyor.com/docs/build-environment/#build-vm-configurations
        :: CPU_COUNT is passed through conda build: https://github.com/conda/conda-build/pull/1149
        set CPU_COUNT=2

        set PYTHONUNBUFFERED=1

        conda config --set show_channel_urls true
        conda config --set auto_update_conda false
        conda config --set add_pip_as_python_dependency false

        call setup_x64

        :: Set the conda-build working directory to a smaller path
        if "%CONDA_BLD_PATH%" == "" (
            set "CONDA_BLD_PATH=C:\\bld\\"
        )

        :: Remove some directories from PATH
        set "PATH=%PATH:C:\\ProgramData\\Chocolatey\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\sbt\\bin;=%"
        set "PATH=%PATH:C:\\Rust\\.cargo\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\usr\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\cmd;=%"
        set "PATH=%PATH:C:\\Program Files\\Git\\mingw64\\bin;=%"
        set "PATH=%PATH:C:\\Program Files (x86)\\Subversion\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\CMake\\bin;=%"
        set "PATH=%PATH:C:\\Program Files\\OpenSSL\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\c\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\bin;=%"
        set "PATH=%PATH:C:\\Strawberry\\perl\\site\\bin;=%"
        set "PATH=%PATH:c:\\tools\\php;=%"

        :: On azure, there are libcrypto*.dll & libssl*.dll under
        :: C:\\Windows\\System32, which should not be there (no vendor dlls in windows folder).
        :: They would be found before the openssl libs of the conda environment, so we delete them.
        if defined CI (
            DEL C:\\Windows\\System32\\libcrypto-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libcrypto-1_1-x64.dll)
            DEL C:\\Windows\\System32\\libssl-1_1-x64.dll || (Echo Ignoring failure to delete C:\\Windows\\System32\\libssl-1_1-x64.dll)
        )

        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        mkdir "%CONDA%\\etc\\conda\\activate.d"

        echo set "CONDA_BLD_PATH=%CONDA_BLD_PATH%"         > "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "CPU_COUNT=%CPU_COUNT%"                  >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PYTHONUNBUFFERED=%PYTHONUNBUFFERED%"    >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"
        echo set "PATH=%PATH%"                            >> "%CONDA%\\etc\\conda\\activate.d\\conda-forge-ci-setup-activate.bat"

        conda info
        conda config --show-sources
        conda list --show-channel-urls
      displayName: conda-forge build setup
    - script: |
        setlocal EnableExtensions EnableDelayedExpansion
        call %CONDA%\condabin\conda_hook.bat
        call %CONDA%\condabin\conda.bat activate base

        set "PATH=%PATH:C:\ProgramData\Chocolatey\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\sbt\bin;=%"
        set "PATH=%PATH:C:\Rust\.cargo\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\usr\bin;=%"
        set "PATH=%PATH:C:\Program Files\Git\cmd;=%"
        set "PATH=%PATH:C:\Program Files\Git\mingw64\bin;=%"
        set "PATH=%PATH:C:\Program Files (x86)\Subversion\bin;=%"
        set "PATH=%PATH:C:\Program Files\CMake\bin;=%"
        set "PATH=%PATH:C:\Program Files\OpenSSL\bin;=%"
        set "PATH=%PATH:C:\Strawberry\c\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\bin;=%"
        set "PATH=%PATH:C:\Strawberry\perl\site\bin;=%"
        set "PATH=%PATH:c:\tools\php;=%"
        :: Make paths like C:\\hostedtoolcache\\windows\\Ruby\\2.5.7\\x64\\bin garbage
        set "PATH=%PATH:ostedtoolcache=%"

        echo "PATH is %PATH%"
        echo "CONDA_BLD_PATH is %CONDA_BLD_PATH%"

        rmdir /Q/S C:\Strawberry\
        rmdir /Q/S "C:\Program Files (x86)\Windows Kits\10\Include\10.0.17763.0\"

        set "FEEDSTOCK_ROOT=%cd%"

        call conda config --remove channels defaults
        call conda config --add channels conda-forge
        call conda config --add channels robostack-experimental
        call conda config --add channels %CONDA_BLD_PATH%
        :: call conda config --set channel_priority strict

        :: Enable long path names on Windows
        reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f

        :: conda remove --force m2-git

        C:\Miniconda\python.exe -m pip install git+https://github.com/mamba-org/boa.git@master
        if errorlevel 1 exit 1

        for %%X in (%CURRENT_RECIPES%) do (
            echo "BUILDING RECIPE %%X"
            cd %FEEDSTOCK_ROOT%\recipes\%%X\
            boa build . -m %FEEDSTOCK_ROOT%\.ci_support\conda_forge_pinnings.yaml -m %FEEDSTOCK_ROOT%\conda_build_config.yaml
            if errorlevel 1 exit 1
        )

        anaconda -t %ANACONDA_API_TOKEN% upload "C:\bld\win-64\*.tar.bz2" --force
        if errorlevel 1 exit 1
      env:
        ANACONDA_API_TOKEN: $(ANACONDA_API_TOKEN)
        CURRENT_RECIPES: ros-galactic-rosbag2-tests ros-galactic-ros-core ros-galactic-rosbag2
          ros-galactic-ros-base
        PYTHONUNBUFFERED: 1
      displayName: Build ros-galactic-rosbag2-tests ros-galactic-ros-core ros-galactic-rosbag2
        ros-galactic-ros-base
